-- üåà JOHN SCRIPT MODERNO COMPLETO
-- GUI con botones rainbow, minimizable y bot√≥n flotante movible

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- =========================
-- BOT√ìN REDONDO FLOTANTE (MOVIBLE)
-- =========================
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 50, 0, 50)
toggleButton.Position = UDim2.new(0.9, 0, 0.8, 0)
toggleButton.AnchorPoint = Vector2.new(0.5, 0.5)
toggleButton.Text = "‚öôÔ∏è"
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextScaled = true
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.BackgroundColor3 = Color3.fromRGB(30,30,30)
toggleButton.BorderSizePixel = 0
toggleButton.Name = "ToggleButton"
toggleButton.Parent = PlayerGui

local tbCorner = Instance.new("UICorner")
tbCorner.CornerRadius = UDim.new(0,25)
tbCorner.Parent = toggleButton

-- Gradiente rainbow animado
local tbGradient = Instance.new("UIGradient")
tbGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255,0,0)),
	ColorSequenceKeypoint.new(0.16, Color3.fromRGB(255,127,0)),
	ColorSequenceKeypoint.new(0.33, Color3.fromRGB(255,255,0)),
	ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0,255,0)),
	ColorSequenceKeypoint.new(0.66, Color3.fromRGB(0,0,255)),
	ColorSequenceKeypoint.new(0.83, Color3.fromRGB(75,0,130)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(148,0,211)),
})
tbGradient.Rotation = 0
tbGradient.Parent = toggleButton

-- Animaci√≥n gradiente del bot√≥n flotante
task.spawn(function()
	while true do
		for i=0,360 do
			tbGradient.Rotation = i
			task.wait(0.03)
		end
	end
end)

-- Hacer movible el bot√≥n
local dragging, dragInput, dragStart, startPos
local function update(input)
	local delta = input.Position - dragStart
	toggleButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

toggleButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = toggleButton.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)
toggleButton.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)

-- =========================
-- CREAR GUI PRINCIPAL
-- =========================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "JohnScriptUI"
screenGui.Parent = PlayerGui
screenGui.Enabled = false -- inicia cerrado

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 260, 0, 220)
frame.Position = UDim2.new(0.5, -130, 0.5, -110)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.BorderSizePixel = 0
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,12)
corner.Parent = frame

-- Sombra
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.AnchorPoint = Vector2.new(0.5,0.5)
shadow.Position = UDim2.new(0.5,0,0.5,4)
shadow.Size = UDim2.new(1,30,1,30)
shadow.ZIndex = -1
shadow.BackgroundTransparency = 1
shadow.Image = "rbxassetid://1316045217"
shadow.ImageTransparency = 0.45
shadow.Parent = frame

-- T√≠tulo
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,30)
title.Position = UDim2.new(0,0,0,0)
title.BackgroundTransparency = 1
title.Text = "üåà JohnScript"
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Parent = frame

-- Bot√≥n minimizar
local minButton = Instance.new("TextButton")
minButton.Size = UDim2.new(0,30,0,30)
minButton.Position = UDim2.new(1,-35,0,2)
minButton.AnchorPoint = Vector2.new(0,0)
minButton.Text = "‚Äì"
minButton.Font = Enum.Font.GothamBold
minButton.TextScaled = true
minButton.TextColor3 = Color3.fromRGB(255,255,255)
minButton.BackgroundColor3 = Color3.fromRGB(50,50,50)
minButton.BorderSizePixel = 0
minButton.Parent = frame
local minCorner = Instance.new("UICorner")
minCorner.CornerRadius = UDim.new(0,6)
minCorner.Parent = minButton

local minimized = false
minButton.MouseButton1Click:Connect(function()
	minimized = not minimized
	for _,v in pairs(frame:GetChildren()) do
		if v:IsA("TextButton") and v ~= minButton then
			v.Visible = not minimized
		end
	end
end)

-- Gradiente rainbow para la ventana
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255,0,0)),
	ColorSequenceKeypoint.new(0.16, Color3.fromRGB(255,127,0)),
	ColorSequenceKeypoint.new(0.33, Color3.fromRGB(255,255,0)),
	ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0,255,0)),
	ColorSequenceKeypoint.new(0.66, Color3.fromRGB(0,0,255)),
	ColorSequenceKeypoint.new(0.83, Color3.fromRGB(75,0,130)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(148,0,211)),
})
gradient.Rotation = 0
gradient.Parent = frame

-- Animaci√≥n gradiente ventana
task.spawn(function()
	while true do
		for i=0,360 do
			gradient.Rotation = i
			task.wait(0.03)
		end
	end
end)

-- =========================
-- BOTONES PRINCIPALES RAINBOW
-- =========================
local function createButton(text,posY,colorStart,colorEnd)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0,220,0,45)
	btn.Position = UDim2.new(0.5,-110,0,posY)
	btn.Text = text
	btn.Font = Enum.Font.Gotham
	btn.TextScaled = true
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.BackgroundColor3 = Color3.fromRGB(30,30,30)
	btn.BorderSizePixel = 0
	btn.Parent = frame
	
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0,8)
	corner.Parent = btn
	
	local grad = Instance.new("UIGradient")
	grad.Color = ColorSequence.new({ColorSequenceKeypoint.new(0,colorStart),ColorSequenceKeypoint.new(1,colorEnd)})
	grad.Rotation = 90
	grad.Parent = btn
	
	-- animaci√≥n "cayendo"
	task.spawn(function()
		while true do
			for r=0,360 do
				grad.Rotation = r
				task.wait(0.02)
			end
		end
	end)
	
	btn.MouseEnter:Connect(function()
		btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
	end)
	btn.MouseLeave:Connect(function()
		btn.BackgroundColor3 = Color3.fromRGB(30,30,30)
	end)
	return btn
end

local saveButton = createButton("üíæ Guardar Posici√≥n",50,Color3.fromRGB(255,0,0),Color3.fromRGB(0,255,0))
local teleportButton = createButton("‚ö° Teletransportar",110,Color3.fromRGB(0,0,255),Color3.fromRGB(255,0,255))

-- =========================
-- BOT√ìN PARA ARRASTRAR FRAME
-- =========================
local dragButton = Instance.new("TextButton")
dragButton.Size = UDim2.new(1,0,0,30)
dragButton.BackgroundTransparency = 1
dragButton.BorderSizePixel = 0
dragButton.Text = ""
dragButton.Parent = frame

dragging, dragInput, dragStart, startPos = false, nil, nil, nil
local function updateFrame(input)
	local delta = input.Position - dragStart
	frame.Position = UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
end
dragButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)
dragButton.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		updateFrame(input)
	end
end)

-- =========================
-- TOGGLE ABRIR/CERRAR GUI
-- =========================
toggleButton.MouseButton1Click:Connect(function()
	screenGui.Enabled = not screenGui.Enabled
end)

-- ==========================================
-- FUNCIONES ORIGINALES (NO TOCADAS)
-- ==========================================
local function savePosition()
	local character = player.Character or player.CharacterAdded:Wait()
	local position = character:GetPrimaryPartCFrame().Position
	return position
end

local function teleportToPosition(targetPosition)
	local character = player.Character or player.CharacterAdded:Wait()
	local humanoid = character:WaitForChild("Humanoid")
	local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

	local gravity = humanoidRootPart.AssemblyLinearVelocity
	humanoidRootPart.AssemblyLinearVelocity = Vector3.new(0,0,0)
	humanoidRootPart.CFrame = CFrame.new(targetPosition)

	humanoid.PlatformStand = true
	wait(0.1)
	humanoid.PlatformStand = false

	humanoid.PlatformStand = true
	wait(0.5)
	humanoid.PlatformStand = false

	humanoidRootPart.AssemblyLinearVelocity = gravity
end

local savedPosition

saveButton.MouseButton1Click:Connect(function()
	savedPosition = savePosition()
	print("Posici√≥n guardada:", savedPosition)
end)

teleportButton.MouseButton1Click:Connect(function()
	if savedPosition then
		teleportToPosition(savedPosition)
		print("Teletransportado a la posici√≥n guardada y puesto en ragdoll")
	else
		print("Primero guarda una posici√≥n")
	end
end)

local function preventRespawn()
	local character = player.Character or player.CharacterAdded:Wait()
	local humanoid = character:WaitForChild("Humanoid")

	humanoid.Died:Connect(function()
		wait(0.1)
		local newCharacter = player.Character or player.CharacterAdded:Wait()
		local newHumanoid = newCharacter:WaitForChild("Humanoid")
		newHumanoid.PlatformStand = true
		wait(0.5)
		newHumanoid.PlatformStand = false
	end)
end

preventRespawn()
